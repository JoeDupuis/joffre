<div class="container">
  <h1><%= @game.name %></h1>

  <div class="game-info">
    <p><strong>Game Code:</strong> <%= @game.game_code %></p>
    <% if @game.password_digest.present? %>
      <p><em>This game is password protected</em></p>
    <% end %>
  </div>

  <div class="teams">
    <h2 class="-title">Teams (<%= @game.players.count %>/4 players)</h2>
    <div class="-container">
      <div class="-team">
        <h3 class="-heading">Team 1</h3>
        <ul class="-players">
          <% @game.players.team_one.includes(:user).each do |player| %>
            <li class="-player">
              <%= player.user.name %>
              <% if player.owner? %>
                <span class="badge">Owner</span>
              <% end %>
              <% if @game.owner == Current.user %>
                <%= button_to "→ Move to Team 2", games_player_path(player), method: :patch, params: { player: { team: 2 } }, class: "button --small" %>
              <% end %>
              <% if @game.owner == Current.user && player.user != Current.user %>
                <%= button_to "Kick", games_player_path(player), method: :delete, class: "button --small" %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="-team">
        <h3 class="-heading">Team 2</h3>
        <ul class="-players">
          <% @game.players.team_two.includes(:user).each do |player| %>
            <li class="-player">
              <%= player.user.name %>
              <% if player.owner? %>
                <span class="badge">Owner</span>
              <% end %>
              <% if @game.owner == Current.user %>
                <%= button_to "← Move to Team 1", games_player_path(player), method: :patch, params: { player: { team: 1 } }, class: "button --small" %>
              <% end %>
              <% if @game.owner == Current.user && player.user != Current.user %>
                <%= button_to "Kick", games_player_path(player), method: :delete, class: "button --small" %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <div class="actions">
    <% if @game.owner == Current.user && @game.players.count == 4 %>
      <%= button_to "Start Game", game_path(@game), method: :patch, params: { game: { status: :started } }, class: "button" %>
    <% end %>
    <% if @game.owner == Current.user %>
      <%= button_to "Delete Game", game_path(@game), method: :delete, class: "button" %>
    <% elsif (player = @game.players.find_by(user: Current.user)) %>
      <%= button_to "Quit Game", games_player_path(player), method: :delete, class: "button" %>
    <% end %>
    <%= link_to "Back to Dashboard", root_path, class: "button" %>
  </div>
</div>
